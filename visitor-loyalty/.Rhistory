## CHECK IF PACKAGES REQUIRED WERE INSTALLED IN R
rm(list = ls())
depends <- c("tidyverse", "data.table")
pkgs <- rownames(installed.packages())
for(d in depends){
if(!(d %in% pkgs)){
install.packages(d)
}
}
library(tidyverse)
library(data.table)
library(combinat)
library(gtools)
####### ####### ####### ####### ####### ####### ####### ####### ####### #######
## LOAD THE GULFOOD EXHIBITOR 2018 DATA
exhData <- fread("./dta/2018exh.csv", colClasses = "character")
exh <- setDT(exhData)
str(exh)
names(exh)
exh[] <- lapply(exh[], function(x) gsub("[^A-z0-9]", "", x))  ## REMOVE NON-LETTER AND NON-INTEGER CHARACTERS
exh[] <- lapply(exh, tolower)
exh[] <- lapply(exh, function(x) gsub("^$", NA, x)) ## REPLACE BLANKS WITH NA
exhnames <- tolower(names(exh))
exhnames[] <- lapply(exhnames, function(x) gsub(" ", "", x)) ## REPLACE BLANKS WITH NA
exhnames <- as.vector(unlist(exhnames))
names(exh) <- exhnames
naCount <- rowSums(is.na(exh)) # count NAs per row
exh <- setDT(exh[naCount < 5, ]) # remove rows that has > 4 entries
exh[is.na(exh)] <- ""   # replace NAs with blanks
####### ####### ####### ####### ####### ####### ####### ####### ####### #######
## LOAD THE GULFOOD 2017 VISITOR DATA
visData <- fread("./dta/2017vis.csv", colClasses = "character")
vis <- setDT(visData)
str(vis)
vis[] <- lapply(vis[], function(x) gsub("[^A-z0-9]", "", x))  ## REMOVE NON-LETTER AND NON-INTEGER CHARACTERS
vis[] <- lapply(vis, tolower)
vis[] <- lapply(vis, function(x) gsub("^$", NA, x)) ## REPLACE BLANKS WITH NA
visnames <- tolower(names(vis))
visnames[] <- lapply(visnames, function(x) gsub(" ", "", x)) ## REPLACE BLANKS WITH NA
visnames <- as.vector(unlist(visnames))
names(vis) <- visnames
naCount <- rowSums(is.na(vis)) # count NAs per row
vis <- setDT(vis[naCount < 5, ]) # remove rows that has > 4 entries
vis[is.na(vis)] <- ""  # replace NAs with blanks
## PURPOSE : THIS IS TO IDENTIFY THE PEOPLE WHO WERE ALSO VISITORA IN 2017 AND 2016 GULFOOD SHOWS
## CREATION DATE : 3/3/2018
## LAST UPDATE :
## VERSION : 1
## AUTHOR : GREJELL SEGURA
## CHECK IF PACKAGES REQUIRED WERE INSTALLED IN R
rm(list = ls())
depends <- c("tidyverse", "data.table")
pkgs <- rownames(installed.packages())
for(d in depends){
if(!(d %in% pkgs)){
install.packages(d)
}
}
library(tidyverse)
library(data.table)
library(combinat)
library(gtools)
####### ####### ####### ####### ####### ####### ####### ####### ####### #######
## LOAD THE GULFOOD 2018 VISITOR DATA
vis2018Data <- fread("./dta/2018vis.csv", colClasses = "character")
vis2018 <- setDT(vis2018Data)
str(vis2018)
names(vis2018)
vis2018[] <- lapply(vis2018[], function(x) gsub("[^A-z0-9]", "", x))  ## REMOVE NON-LETTER AND NON-INTEGER CHARACTERS
vis2018[] <- lapply(vis2018, tolower)
vis2018[] <- lapply(vis2018, function(x) gsub("^$", NA, x)) ## REPLACE BLANKS WITH NA
vis2018names <- tolower(names(vis2018))
vis2018names[] <- lapply(vis2018names, function(x) gsub(" ", "", x)) ## REPLACE BLANKS WITH NA
vis2018names <- as.vector(unlist(vis2018names))
names(vis2018) <- vis2018names
naCount <- rowSums(is.na(vis2018)) # count NAs per row
vis2018 <- setDT(vis2018[naCount < 5, ]) # remove rows that has > 4 entries
vis2018[is.na(vis2018)] <- ""   # replace NAs with blanks
####### ####### ####### ####### ####### ####### ####### ####### ####### #######
## LOAD THE GULFOOD 2017 VISITOR DATA
vis2017Data <- fread("./dta/2017vis.csv", colClasses = "character")
vis2017 <- setDT(vis2017Data)
str(vis2017)
vis2017[] <- lapply(vis2017[], function(x) gsub("[^A-z0-9]", "", x))  ## REMOVE NON-LETTER AND NON-INTEGER CHARACTERS
vis2017[] <- lapply(vis2017, tolower)
vis2017[] <- lapply(vis2017, function(x) gsub("^$", NA, x)) ## REPLACE BLANKS WITH NA
vis2017names <- tolower(names(vis2017))
vis2017names[] <- lapply(vis2017names, function(x) gsub(" ", "", x)) ## REPLACE BLANKS WITH NA
vis2017names <- as.vector(unlist(vis2017names))
names(vis2017names) <- vis2017names
naCount <- rowSums(is.na(vis2017)) # count NAs per row
vis2017 <- setDT(vis2017[naCount < 5, ]) # remove rows that has > 4 entries
vis2017[is.na(vis2017)] <- ""  # replace NAs with blanks
####### ####### ####### ####### ####### ####### ####### ####### ####### #######
## create permutation / combination of names
vis2018names <- names(vis2018[, -1])
listcombi <- data.frame()
for (i in c(1:length(vis2018names))) {
combi <- combn(vis2018names, m = i)
combi <- as.data.frame(combi)
combi <- as.data.frame(t(combi))
listcombi <- smartbind(listcombi, combi)
listcombi <- unique(listcombi)
}
listcombi <- listcombi[-c(1:4),] ## remove single combination except for email
listcombi <- listcombi[-c(3,4,5,8,9,12),]
listcombi$na <- rowSums(is.na(listcombi))
listcombi <- listcombi[with(listcombi, order(na)),]
listcombi <- listcombi[, -7]
####### ####### ####### ####### ####### ####### ####### ####### ####### #######
## create a concatenate function ##
concatenate <- function(data){
for (j in (1:nrow(listcombi))){
c <- unname(unlist(listcombi[j, ]))
c <- c[!is.na(c)]
combiname <- paste("combi", j, collapse = "")
data[, (combiname) := apply(data[, c, with = FALSE], 1, paste, collapse = ""), with = FALSE]
}
}
concatenate(data = vis2018)
concatenate(data = vis2017)
vis2018 <- vis2018[, -c(2:7)]
vis2017 <- vis2017[, -c(2:7)]
names(vis2018)[1] <- "id"
names(vis2017)[1] <- "id"
## MERGE VIS AND vis2018
allnames <- names(vis2018[, -1])
mergeData <- data.frame()
for (i in allnames) {
cols <- c("id", i)
x <- vis2018[, cols, with = FALSE]
x <- unique(x)
x$n <- nchar(x[, 2])
x <- x[x$n > 7, ]
x <- x[, -3]
y <- vis2017[, cols, with = FALSE]
y <- unique(y)
y$n <- nchar(y[, 2])
y <- y[y$n > 7, ]
y <- y[, -3]
z <- merge(x, y, by = i)
names(z)[1] <- "combi"
mergeData <- rbind(mergeData, z)
}
mergeData <- mergeData[mergeData$combi != "", ]
names(mergeData)[c(2,3)] <- c("id", "visitor ID 2017")
## merge with visitor data ##
names(vis2018Data)[1] <- "id"
mergeData <- merge(mergeData, vis2018Data, by = "id", all.y = TRUE)
mergeData <- setDT(mergeData)
mergeData[, seq := seq(.N), by = id]
mergeData <- mergeData[seq == 1, ]
mergeData[is.na(mergeData), ] <- "NF"
fwrite(mergeData, "./dta/finalData.csv")
## CHECK IF PACKAGES REQUIRED WERE INSTALLED IN R
rm(list = ls())
depends <- c("tidyverse", "data.table")
pkgs <- rownames(installed.packages())
for(d in depends){
if(!(d %in% pkgs)){
install.packages(d)
}
}
library(tidyverse)
library(data.table)
library(combinat)
library(gtools)
####### ####### ####### ####### ####### ####### ####### ####### ####### #######
## LOAD THE GULFOOD 2018 VISITOR DATA
vis2018Data <- fread("./dta/2018vis.csv", colClasses = "character")
vis2018 <- setDT(vis2018Data)
str(vis2018)
names(vis2018)
q()
## CHECK IF PACKAGES REQUIRED WERE INSTALLED IN R
rm(list = ls())
depends <- c("tidyverse", "data.table")
pkgs <- rownames(installed.packages())
for(d in depends){
if(!(d %in% pkgs)){
install.packages(d)
}
}
library(tidyverse)
library(data.table)
library(combinat)
library(gtools)
####### ####### ####### ####### ####### ####### ####### ####### ####### #######
## LOAD THE GULFOOD 2018 VISITOR DATA
vis2018Data <- fread("./dta/2018vis.csv", colClasses = "character")
vis2018 <- setDT(vis2018Data)
str(vis2018)
names(vis2018)
vis2018[] <- lapply(vis2018[], function(x) gsub("[^A-z0-9]", "", x))  ## REMOVE NON-LETTER AND NON-INTEGER CHARACTERS
vis2018[] <- lapply(vis2018, tolower)
vis2018[] <- lapply(vis2018, function(x) gsub("^$", NA, x)) ## REPLACE BLANKS WITH NA
vis2018names <- tolower(names(vis2018))
vis2018names[] <- lapply(vis2018names, function(x) gsub(" ", "", x)) ## REPLACE BLANKS WITH NA
vis2018names <- as.vector(unlist(vis2018names))
names(vis2018) <- vis2018names
naCount <- rowSums(is.na(vis2018)) # count NAs per row
vis2018 <- setDT(vis2018[naCount < 5, ]) # remove rows that has > 4 entries
vis2018[is.na(vis2018)] <- ""   # replace NAs with blanks
####### ####### ####### ####### ####### ####### ####### ####### ####### #######
## LOAD THE GULFOOD 2017 VISITOR DATA
vis2017Data <- fread("./dta/2017vis.csv", colClasses = "character")
q()
